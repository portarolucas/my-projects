{"version":3,"sources":["webpack:///./src/views/Conversation.vue","webpack:///./src/views/Conversation.vue?7665","webpack:///./src/views/Conversation.vue?976d"],"names":["class","title","messages_count","messages","elem","message","user_isAdmin","createMessage","style","newMessage","type","placeholder","name","data","uuid","messagesRefresh","watch","this","updated","methods","init","loadData","setConversationRead","refreshMessage","window","scrollTo","document","body","scrollHeight","api","get","then","response","reverse","count","catch","error","status","console","log","$router","push","alert","message_status","conversation","admin","admin_info","post","_conversations","mitt","emit","created","$route","params","setInterval","mounted","beforeUnmount","clearInterval","render","__scopeId"],"mappings":"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","file":"js/chunk-f721d834.02a6d7c7.js","sourcesContent":["<template>\n  <div class=\"main-content\">\n    <div class=\"backgrounds-container\">\n      <div class=\"bg-1-container\">\n        <div class=\"bg\"></div>\n      </div>\n      <div class=\"bg-2-container\">\n        <div class=\"bg\"></div>\n      </div>\n      <div class=\"bg-3-container\">\n        <div class=\"bg\"></div>\n      </div>\n      <div class=\"bg-4-container\">\n        <div class=\"bg\"></div>\n      </div>\n      <div class=\"bg-5-container\">\n        <div class=\"bg\"></div>\n      </div>\n    </div>\n    <div>\n      <h1><u>{{ this.title }}</u></h1>\n      <h3>Voici les derniers messages (total: {{ messages_count }})</h3>\n      <div class=\"panel\">\n        <div class=\"messages\">\n            <div class=\"message\" v-bind:class=\"{ 'self-message' : elem.message.user_isAdmin == false }\" v-for=\"elem in messages\">\n              {{ elem.message.message }}\n            </div>\n        </div>\n        <div class=\"footer-conversation\">\n          <form @submit.prevent=\"createMessage\" class=\"send-message\" style=\"width: 100%;\">\n            <input v-model=\"newMessage\" type=\"text\" placeholder=\"Envoyer un message\"/>\n            <button>Envoyer</button>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport $ from 'jquery'\n\nexport default {\n  name: 'Conversation',\n  data(){\n    return {\n      messages: [],\n      title: '',\n      uuid: null,\n      messages_count: '',\n      newMessage: '',\n      messagesRefresh: null\n    }\n  },\n  watch:{\n    messages: function(){\n      this.updated()\n    }\n  },\n  methods:{\n    init(){\n      this.loadData();\n      this.setConversationRead()\n    },\n    refreshMessage(){\n      this.loadData();\n    },\n    updated(){\n      window.scrollTo(0,document.body.scrollHeight);\n    },\n    loadData(){\n      //this.$route.params.uuid\n      api.get('/conversations/' + this.uuid + '/messages?size=20').then(response => {\n        this.messages = response.data.messages.reverse();//reverse pour avoir les derniers messages posté en bas\n        this.messages_count = response.data.count\n      }).catch(error => {\n        if(error.response.status === 403){\n          console.log('interdit')\n          this.$router.push('/conversations')\n        }else{\n          alert((error.response.data.message_status) ? error.response.data.message_status : \"Votre action n'a pû aboutir, une erreur inconnue s'est produite.\")\n        }\n      })\n      api.get('/conversations/' + this.uuid).then(response => {\n        this.title = response.data.conversation.title\n        this.admin = response.data.conversation.admin_info\n      }).catch(error => {\n        if(error.response.status === 403){\n          console.log('interdit')\n          this.$router.push('/conversations')\n        }else{\n          alert((error.response.data.message_status) ? error.response.data.message_status : \"Votre action n'a pû aboutir, une erreur inconnue s'est produite.\")\n        }\n      })\n    },\n    createMessage(){\n      if(this.newMessage != ''){\n        api.post('/conversations/' + this.uuid + '/messages', {'message' : this.newMessage}).then(response => {\n          alert(response.data.message_status)\n          this.loadData();\n          this.newMessage = '';\n        })\n      }else{\n        alert(\"Vous devez entrer un message et ensuite l'envoyer...\")\n      }\n    },\n    setConversationRead(){\n      let _conversations = []\n      _conversations.push(this.uuid)\n\n      api.post('/account/conversations', {'conversations' : _conversations}).then(response => {\n        window.mitt.emit('update_menu_conversation')\n      })\n    }\n  },\n  updated(){\n    window.scrollTo(0,document.body.scrollHeight);\n  },\n  created(){\n    this.uuid = this.$route.params.uuid;\n    this.messagesRefresh = setInterval(() => {\n      console.log('INTERVAL (conversation)')//TODO ne pas oublier de supprimer\n      this.refreshMessage();\n    }, 1000)\n  },\n  mounted(){\n    this.init();\n  },\n  beforeUnmount: function () {\n    console.log('INTERVAL (conversation) : SUPPRIMÉ')//TODO ne pas oublier de supprimer\n    clearInterval(this.messagesRefresh);\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\nbody{\n  padding: 0;\n}\n\n.messages{\n  display: flex;\n  flex-wrap: wrap;\n  -webkit-flex-direction: column;\n  flex-direction: column;\n  background-color: #ecf0f1;\n  padding: 1rem 1rem 0 1rem;\n  margin-bottom: 60px;\n\n  .message{\n    width: 70%;\n    align-self: flex-start;\n    margin-bottom: 1rem;\n    padding: 5px;\n    border: 1px solid black;\n\n    &.self-message{\n      align-self: flex-end !important;\n    }\n  }\n}\n\n.footer-conversation form{\n  position: fixed;\n  bottom: 0px;\n  width: 100%;\n  height: 50px;\n  background-color: #7f8c8d;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  flex-wrap: nowrap;\n  border-top: 1px solid grey;\n\n  input[type=\"text\"]{\n    border: none;\n    width: 80%;\n    height: 50px;\n    padding: 0 1rem;\n    outline-color: none;\n    outline: 0;\n    &:hover{\n      outline: 0;\n    }\n  }\n  button{\n    border: 0;\n    width: 20%;\n    height: 50px;\n    color: white;\n    z-index: 999;\n    background-color: #7f8c8d;\n    cursor: pointer;\n  }\n}\n</style>\n","import { render } from \"./Conversation.vue?vue&type=template&id=26c44e04&scoped=true\"\nimport script from \"./Conversation.vue?vue&type=script&lang=js\"\nexport * from \"./Conversation.vue?vue&type=script&lang=js\"\n\nimport \"./Conversation.vue?vue&type=style&index=0&id=26c44e04&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-26c44e04\"\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Conversation.vue?vue&type=style&index=0&id=26c44e04&lang=scss&scoped=true\""],"sourceRoot":""}